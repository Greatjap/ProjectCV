<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CV Project - Assistente de Voz</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://www.gstatic.com/dialogflow-console/fast/df-messenger/prod/v1/themes/df-messenger-default.css">
    <script src="https://www.gstatic.com/dialogflow-console/fast/df-messenger/prod/v2/df-messenger.js"></script>

    <style>
        body {
            font-family: 'Google Sans', sans-serif;
            margin: 0;
            background-color: #f8f9fa;
        }

        main {
            padding: 40px;
            max-width: 800px;
            margin: 0 auto;
        }

        h1 { color: #1a73e8; }

        df-messenger {
            z-index: 999;
            position: fixed;
            bottom: 24px;
            right: 24px;
            --df-messenger-chat-background: #f3f6fc;
            --df-messenger-font-family: 'Google Sans', sans-serif;
        }
    </style>
</head>
<body>

    <main>
        <header><strong>CV Project</strong></header>
        <section>
            <h1>Painel de Orientação</h1>
            <p>A conversa será reiniciada toda vez que você atualizar a página.</p>
        </section>
    </main>

    <df-messenger
      location="us-east1"
      project-id="cv-project-483216"
      agent-id="a19ba7a3-3a8a-496a-839b-d8ce61c5fd73"
      language-code="pt-br">
      <df-messenger-chat-bubble
        chat-title="Assistente Virtual"
        allow-mic="all"> </df-messenger-chat-bubble>
    </df-messenger>

    <script>
      // 1. LIMPAR SESSÃO AO CARREGAR (Começa do zero)
      // O Dialogflow armazena a sessão no SessionStorage. Removendo isso, o bot gera um novo ID.
      window.addEventListener('load', () => {
          window.sessionStorage.clear();
      });

      const dfMessenger = document.querySelector('df-messenger');

      // 2. SCRIPT DE VOZ (Bot fala o que escreve)
      dfMessenger.addEventListener('df-response-received', (event) => {
        // Tenta pegar o texto da resposta (ajustado para o formato da V2)
        const messages = event.detail.response.queryResult.fulfillmentMessages;
        if (messages && messages.length > 0) {
            const text = messages[0].text.text[0];
            const synth = window.speechSynthesis;
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'pt-BR';
            synth.speak(utterance);
        }
      });

      // 3. EVENTO DE BOAS-VINDAS (Opcional)
      dfMessenger.addEventListener('df-messenger-loaded', () => {
          // Se quiser que ele comece falando algo:
          // dfMessenger.renderCustomText('Olá! Em que posso ajudar hoje?');
      });
    </script>
    
</body>
</html>
